<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë„ˆì˜ ê¸°ë¶„ì€ ì–´ë– ë‹ˆ?2 (How are you feeling?)</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: system-ui, -apple-system, "Noto Sans KR", Arial, sans-serif;
  }

  body {
    display: grid;
    place-items: center;
    background: #eef2f8;
    transition: background .3s ease;
    overflow: hidden;
    position: relative;
  }

  /* positive ë°°ê²½ */
  body.pos {
    background: linear-gradient(135deg,#bfe4ff,#76b7ff);
  }

  /* negative ë°°ê²½ */
  body.neg {
    background: linear-gradient(135deg,#aab0ba,#5e6672);
  }

  .card {
    width: min(640px,92vw);
    background: #ffffffcc;
    backdrop-filter: blur(6px);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.12);
    position: relative;
    z-index: 2; /* ë¹„ì™€ í•´ë³´ë‹¤ ìœ„/ì•„ë˜ ì¡°ì •: ë¹„(1), ì¹´ë“œ(2), í•´(3)ë¡œ ê°ˆ ê±°ë¼ í•´ëŠ” ë” ìœ„ë¡œ ì¤„ ì˜ˆì • */
  }

  h1 {
    margin: 0 0 10px;
    font-size: clamp(22px,4.5vw,32px);
    line-height: 1.3;
  }

  .row {
    display: flex;
    gap: 10px;
  }

  input {
    flex: 1;
    padding: 12px 14px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid #d6dde7;
    outline: none;
  }

  input:focus {
    border-color: #86a7ff;
    box-shadow: 0 0 0 4px #86a7ff33;
  }

  button {
    padding: 0 16px;
    border: 0;
    border-radius: 12px;
    background: #111827;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
  }

  button:active {
    transform: scale(.98);
  }

  .status {
    margin-top: 10px;
    opacity: .9;
    min-height: 1.5em;
    font-size: 15px;
    line-height: 1.4;
  }

  .extra-message {
    margin-top: 6px;
    font-size: 14px;
    line-height: 1.4;
    color: #374151;
    min-height: 1.4em;
  }

  /* ë¹„ (negì¼ ë•Œë§Œ ë³´ì„) */
  .rain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    display: none;
    z-index: 1;
  }

  body.neg .rain {
    display: block;
  }

  .drop {
    position: absolute;
    top: -120px;
    width: 2px;
    height: 90px;
    background: linear-gradient(to bottom, #ffffff88, #ffffff00);
    animation: fall linear infinite;
    opacity: .7;
  }

  @keyframes fall {
    to { transform: translateY(120vh); }
  }

  /* í•´ (positiveì¼ ë•Œ ì™¼ìª½ ìƒë‹¨ì— ë“±ì¥) */
  .sun {
    position: fixed;
    top: -80px;   /* ì‹œì‘ì€ í™”ë©´ ë°”ê¹¥ ìœ„ìª½ */
    left: -80px;  /* ì‹œì‘ì€ í™”ë©´ ë°”ê¹¥ ì™¼ìª½ */
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fffbe8 0%, #ffec6a 40%, #ffcf33 70%, #ffba00 100%);
    box-shadow:
      0 0 30px 10px rgba(255,236,106,0.6),
      0 0 60px 30px rgba(255,207,51,0.25),
      0 0 120px 60px rgba(255,186,0,0.15);
    pointer-events: none;
    opacity: 0;
    transform: translate(-40px,-40px) scale(0.8);
    transition:
      opacity .6s ease,
      transform .6s cubic-bezier(.16,1,.3,1);
    z-index: 3;
  }

  /* ì‚´ì§ í”ë“¤ë¦¬ëŠ” ë¹› í¼ì§ ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes sunPulse {
    0% {
      box-shadow:
        0 0 30px 10px rgba(255,236,106,0.6),
        0 0 60px 30px rgba(255,207,51,0.25),
        0 0 120px 60px rgba(255,186,0,0.15);
    }
    50% {
      box-shadow:
        0 0 36px 14px rgba(255,236,106,0.7),
        0 0 70px 36px rgba(255,207,51,0.3),
        0 0 130px 70px rgba(255,186,0,0.2);
    }
    100% {
      box-shadow:
        0 0 30px 10px rgba(255,236,106,0.6),
        0 0 60px 30px rgba(255,207,51,0.25),
        0 0 120px 60px rgba(255,186,0,0.15);
    }
  }

  /* body.posì¼ ë•Œ sunì´ ë¶€ë“œëŸ½ê²Œ ì•ˆìª½ìœ¼ë¡œ ë‚´ë ¤ì™€ì„œ ë‚˜íƒ€ë‚¨ */
  body.pos .sun {
    opacity: 1;
    transform: translate(20px,20px) scale(1);
    animation: sunPulse 2.5s ease-in-out infinite;
  }
</style>
</head>
<body>
  <div class="card" role="region" aria-label="ê¸°ë¶„ ì…ë ¥ ì¹´ë“œ">
    <h1>ë„ˆì˜ ê¸°ë¶„ì€ ì–´ë– ë‹ˆ? (How are you feeling today?)</h1>
    <p style="margin:0 0 12px">
      ê¸°ë¶„ ë‹¨ì–´ë¥¼ ì ê³  Enter ë˜ëŠ” ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”.<br />
      Write one feeling word and press Enter. <br />
      ì˜ˆ: happy / sad / í–‰ë³µ / ìš°ìš¸ / ì§œì¦ / ì„¤ë ˜
    </p>
    <div class="row">
      <input
        id="mood"
        type="text"
        placeholder="ì˜ˆ: happy / sad / í–‰ë³µ / ìš°ìš¸ ..."
        autocomplete="off"
        aria-label="ì§€ê¸ˆ ê¸°ë¶„"
      />
      <button id="goBtn" type="button" aria-label="í™•ì¸">í™•ì¸</button>
    </div>
    <div class="status" id="status" aria-live="polite"></div>
    <div class="extra-message" id="extraMessage" aria-live="polite"></div>
  </div>

  <!-- ë¹„ -->
  <div class="rain" id="rain"></div>

  <!-- í•´ -->
  <div class="sun" id="sun" aria-hidden="true"></div>

<script>
  // ===== DOM refs =====
  const body = document.body;
  const input = document.getElementById('mood');
  const goBtn = document.getElementById('goBtn');
  const statusEl = document.getElementById('status');
  const extraEl = document.getElementById('extraMessage');
  const rainEl = document.getElementById('rain');
  const sunEl = document.getElementById('sun');

  // ===== Web Audio context & utils =====
  let audioCtx = null;

  function ensureAudio() {
    if (!audioCtx || audioCtx.state === 'closed') {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
  }

  // fade out placeholder (ë¯¸ë˜ì— ì—¬ëŸ¬ ì†ŒìŠ¤ ì¶”ì í•˜ê³  stop í•˜ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì„œ í•˜ë©´ ë¨)
  function fadeOutAll() {
    // í˜„ì¬ êµ¬ì¡°ì—ì„œëŠ” ê° ì‚¬ìš´ë“œê°€ ìê¸° gain envelopeìœ¼ë¡œ ì•Œì•„ì„œ ëë‚˜ë¯€ë¡œ
    // ë”°ë¡œ ì „ì—­ stopì€ ì•ˆ í•´ë„ ë¼.
  }

  function playPositive() {
    ensureAudio();
    const now = audioCtx.currentTime;
    const master = audioCtx.createGain();
    master.gain.value = 0;
    master.connect(audioCtx.destination);

    // ì§§ì€ ìƒí–‰ 3ìŒ (ë„-ë¯¸-ì†”)
    [261.63, 329.63, 392.00].forEach((f, i) => {
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.value = f;

      const t0 = now + i * 0.03;
      const t1 = t0 + 0.35;

      g.gain.setValueAtTime(0, t0);
      g.gain.linearRampToValueAtTime(0.6, t0 + 0.05);
      g.gain.exponentialRampToValueAtTime(0.0001, t1);

      osc.connect(g);
      g.connect(master);

      osc.start(t0);
      osc.stop(t1 + 0.02);
    });

    master.gain.linearRampToValueAtTime(0.9, now + 0.05);
    master.gain.exponentialRampToValueAtTime(0.0001, now + 0.6);
  }

  function playNegative() {
    ensureAudio();
    const now = audioCtx.currentTime;
    const dur = 1.8;

    // í™”ì´íŠ¸ ë…¸ì´ì¦ˆ (ë¹„ ì†Œë¦¬ ëŠë‚Œ)
    const bufferSize = Math.floor(audioCtx.sampleRate * dur);
    const buf = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * 0.45;
    }

    const src = audioCtx.createBufferSource();
    src.buffer = buf;

    const lp = audioCtx.createBiquadFilter();
    lp.type = 'lowpass';
    lp.frequency.value = 1800;

    const hp = audioCtx.createBiquadFilter();
    hp.type = 'highpass';
    hp.frequency.value = 180;

    const m = audioCtx.createGain();
    m.gain.value = 0;

    src.connect(lp);
    lp.connect(hp);
    hp.connect(m);
    m.connect(audioCtx.destination);

    m.gain.linearRampToValueAtTime(0.7, now + 0.1);
    m.gain.exponentialRampToValueAtTime(0.0001, now + dur);

    src.start(now);
    src.stop(now + dur + 0.02);
  }

  // ===== ê°ì • ë‹¨ì–´ ì‚¬ì „ =====
  const POS = new Set([
    // EN
    'happy','joy','joyful','glad','good','great','awesome','amazing','love','lovely',
    'excited','exciting','delight','delighted','proud','calm','peace','peaceful',
    'relaxed','fun','fine','cool','superb','fantastic','wonderful','hopeful','optimistic',
    // KR
    'í–‰ë³µ','ê¸°ì¨','ê¸°ì˜','ì¢‹ì•„','ì¢‹ìŒ','ì¢‹ë‹¤','ìµœê³ ','ì‚¬ë‘','ì„¤ë ˜','ì„¤ë ˆ','ì‹ ë‚¨','ì‹ ë‚˜',
    'ë¿Œë“¯','í‰ì˜¨','ì—¬ìœ ','í¸ì•ˆ','íë§','ê´œì°®','ê°ì‚¬','ë§Œì¡±','í–‰ë³µí•´','ì¦ê±°','ì¦ê±°ì›€'
  ]);

  const NEG = new Set([
    // EN
    'sad','bad','worse','terrible','awful','angry','mad','upset','depress','depressed',
    'tired','sleepy','bored','boring','stress','stressed','anxious','anxiety','lonely',
    'hate','sick','hurt','pain','gloomy','blue','down',
    // KR
    'ìŠ¬í””','ìŠ¬í¼','ìŠ¬í”„','ìš°ìš¸','í”¼ê³¤','ì§€ì¹¨','ì§€ì³','ì§œì¦','í™”ë‚¨','í™”ë‚˜','ìŠ¤íŠ¸ë ˆìŠ¤',
    'ë¶ˆì•ˆ','ë¶ˆì•ˆí•´','ì™¸ë¡­','ì™¸ë¡œì›€','ì‹«ì–´','ì‹«ë‹¤','ìµœì•…','ë‹µë‹µ','ì†ìƒ','ì‹¬ë€','ì¹¨ìš¸',
    'ê±±ì •','ê±±ì •ë¼','ê±±ì •ì´'
  ]);

  const POS_HINT = [
    'í–‰ë³µ','ê¸°ì¨','ì„¤ë ˜','ì¢‹','ì‚¬ë‘','ì‹ ë‚˜','ë¿Œë“¯','í¸ì•ˆ','í‰ì˜¨','ì¦ê±°','ë©‹',
    'í™˜í¬','í¬ë§','hope','joy','love','good','great','awesome','calm','peace',
    'relax','delight','proud','fun'
  ];

  const NEG_HINT = [
    'ìŠ¬í”„','ìš°ìš¸','í”¼ê³¤','ì§€ë£¨','ì§œì¦','í™”ë‚˜','ë¶ˆì•ˆ','ì™¸ë¡­','ì‹«','ìµœì•…','ë‹µë‹µ',
    'ì†ìƒ','ê±±ì •','ì•„í””','ì•„íŒŒ','ê´´ë¡œ','pain','sad','depress','tired','bored',
    'stress','anxious','lonely','hate','hurt','sick','gloom','down','blue'
  ];

  function guessSentiment(text) {
    const v = String(text || '').trim().toLowerCase();
    if (!v) return 'neutral';

    // ì™„ì „ ì¼ì¹˜
    if (POS.has(v)) return 'pos';
    if (NEG.has(v)) return 'neg';

    const raw = String(text).trim();

    // ë¶€ë¶„ í¬í•¨ í‚¤ì›Œë“œ
    if (POS_HINT.some(k => v.includes(k) || raw.includes(k))) return 'pos';
    if (NEG_HINT.some(k => v.includes(k) || raw.includes(k))) return 'neg';

    // ê°„ë‹¨ ë¶€ì • ë¬¸ì–‘
    if (/\b(not|no|never|ì—†ìŒ|ì•„ë‹ˆ|ë³„ë¡œ|ê·¸ë‹¥)\b/i.test(raw)) return 'neg';

    return 'neutral';
  }

  // ===== ë¹„ íš¨ê³¼ =====
  function makeRain(n=40) {
    rainEl.innerHTML = '';
    const W = innerWidth;
    for (let i = 0; i < n; i++) {
      const d = document.createElement('div');
      d.className = 'drop';
      d.style.left = (Math.random() * W) + 'px';
      d.style.animationDuration = (0.7 + Math.random() * 1.2) + 's';
      d.style.animationDelay = (Math.random() * 1.0) + 's';
      rainEl.appendChild(d);
    }
  }

  function setStatus(msg) {
    statusEl.textContent = msg;
  }
  function setExtra(msg) {
    extraEl.textContent = msg;
  }

  function applyMood(text) {
    const s = guessSentiment(text);

    if (s === 'pos') {
      body.classList.remove('neg');
      body.classList.add('pos');

      setStatus('âœ¨ ì¢‹ì€ ê¸°ë¶„ì´ë„¤ìš”! You seem to feel good ğŸ’™');
      setExtra('ì´ ê¸°ë¶„ ê°„ì§í•˜ê³  ì‹¶ìœ¼ë©´ ìº¡ì²˜í•´ ë‘¬ë„ ì¢‹ì•„ ğŸ˜Œ');

      rainEl.innerHTML = '';
      fadeOutAll();
      playPositive();

      // í•´ëŠ” body.posì— ì˜í•´ ìë™ìœ¼ë¡œ ë‚˜íƒ€ë‚¨ (CSS ì „í™˜)
    } else if (s === 'neg') {
      body.classList.remove('pos');
      body.classList.add('neg');

      setStatus('â˜” ì•ˆ ê´œì°®ì„ ë•Œë„ ìˆì–´ìš”. Itâ€™s okay to feel low.');
      setExtra('ì§€ê¸ˆ ì´ ê°ì •ì„ ë§í•´ì¤€ ê²ƒë§Œìœ¼ë¡œë„ ì´ë¯¸ ì˜í•˜ê³  ìˆì–´ìš”.');

      makeRain(48);
      fadeOutAll();
      playNegative();

    } else {
      body.classList.remove('pos','neg');

      setStatus('ì¤‘ë¦½ì´ì—ìš”. í•œ ë‹¨ì–´ ë” ìì„¸íˆ ì ì–´ë³¼ê¹Œìš”? (ì˜ˆ: í–‰ë³µ, ìš°ìš¸, excited, stressed)');
      setExtra('');

      rainEl.innerHTML = '';
      fadeOutAll();
    }
  }

  // ===== ì´ë²¤íŠ¸ =====
  goBtn.addEventListener('click', () => applyMood(input.value));
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') applyMood(input.value);
  });

  // ===== ì´ˆê¸° ì•ˆë‚´ =====
  setStatus('ê¸°ë¶„ì„ í•œ ë‹¨ì–´ë¡œ ì ì–´ë³´ì„¸ìš”. ì˜ˆ: happy / sad / í–‰ë³µ / ìš°ìš¸ â€¦');
  setExtra('');
</script>
</body>
</html>
